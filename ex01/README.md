# Create a Web3 application from scratch

## Step 1: Create a new react.js application

```bash
npx create-react-app ex01
cd ex01
```

---

## Step 2: Install Hardhat dependencies

```bash
npx hardhat
```

---

## Step 3: Configure Hardhat

Open the `hardhat.config.js` file and add the following lines:

```js
module.exports = {
	solidity: '0.8.12',
	paths: {
		artifacts: './src/artifacts',
	},
	networks: {
		hardhat: {
			chainId: 1337,
		},
	},
}
```

It will configure the output directory to `./src/artifacts` where the artifacts ABI will be generated.
It also configures the network to use the `hardhat` network by choosing the blockchain id.

---

## Step 4: Take a look at the contract

Open the `./contracts/Greeter.sol` file and take a look at the `Greeter` contract.

Rename the `./scrips/sample-script.js` file

```bash
mv scripts/sample-script.js scripts/deploy.js
```

---

## Step 5: Compile the contract

```bash
npx hardhat compile
```

---

## Step 6: Start a local Ethereum node

```
npx hardhat node
```

A new local Ethereum node will be started at address `http://127.0.0.1:8545/` and 20 accounts will be created.

---

## Step 7: Deploy the contract

```bash
npx hardhat run scripts/deploy.js --network localhost
```

We will save the output of the command above in a variable called `deployedContractAddress`.

---

## Step 8: Configure metamask

- Install the [MetaMask extension](https://chrome.google.com/webstore/detail/metamask/nkbihfbeogaeaoehlefnkodbefgpgknn)
- Select the `localhost` network
- Import some of the private keys generated by the `hardhat` command

---

## Step 9: Write the frontend application

Let's start the frontend application.

```bash
npm start
```

Update the `./src/App.js` file with the following code:

```js
import { ethers } from 'ethers'
import { useEffect, useState } from 'react'
import Greeter from './artifacts/contracts/Greeter.sol/Greeter.json'
import './App.css'

const greeterAddress = '0x5fbdb2315678afecb367f032d93f642f64180aa3'

function App() {
	const [greeter, setGreeter] = useState('')
	const [greeterValue, setGreeterValue] = useState('')

	useEffect(async () => {
		await requestAccounts()
		await fetchGreeter()
	})

	async function fetchGreeter() {
		if (typeof window.ethereum !== 'undefined') {
			const provider = new ethers.providers.Web3Provider(window.ethereum)
			const contract = new ethers.Contract(greeterAddress, Greeter.abi, provider)
			try {
				const data = await contract.greet()
				setGreeter(data)
			} catch (error) {
				console.error(error)
			}
		}
	}

	async function updateGreeter(e) {
		e.preventDefault()
		console.log('updateGreeter: ', greeterValue)

		if (!greeterValue) return
		if (typeof window.ethereum !== 'undefined') {
			const provider = new ethers.providers.Web3Provider(window.ethereum)
			const signer = await provider.getSigner()
			const contract = new ethers.Contract(greeterAddress, Greeter.abi, signer)
			const transaction = await contract.setGreeting(greeterValue)
			try {
				await transaction.wait()
				await fetchGreeter()
				setGreeterValue('')
			} catch (error) {
				console.error(error)
			}
		}
	}

	async function requestAccounts() {
		const a = await window.ethereum.request({ method: 'eth_requestAccounts' })
		console.log('requestAccounts: ', a)
	}

	return (
		<div className="App">
			<button onClick={requestAccounts}>Request accounts</button>
			<hr />
			<button onClick={fetchGreeter}>Fetch Greeter</button>
			<hr />
			<p>{greeter}</p>
			<form onSubmit={updateGreeter}>
				<input type="text" onChange={(e) => setGreeterValue(e.target.value)} value={greeterValue} />
				<button type="submit">Update Greeter</button>
			</form>
		</div>
	)
}

export default App
```

Now, let's deploy this contract on the `Ropsten` network.

---

## Step 10: infura.io

- Sign up for an [infura.io](https://infura.io/) account
- Sign in to your account
- Create a new project from the [infura.io dashboard](https://infura.io/dashboard)
- Change the endpoint to `Ropsten`

---

## Step 11: Get some Ethereum

Before deploying on the Ropsten network, we need to get some Ethereum.

Let's get some ETH from faucet websites:

- [faucet.dimensions.network](https://faucet.dimensions.network)
- [faucet.metamask.io](https://faucet.metamask.io)
- [faucet.egorfine.com](https://faucet.egorfine.com)

---

## Step 12: Configure hardhat

Open the `hardhat.config.js` file and add the following lines:

```js
module.exports = {
	solidity: '0.8.12',
	paths: {
		artifacts: './src/artifacts',
	},
	networks: {
		hardhat: {
			chainId: 1337,
		},
		ropsten: {
			// find this URL below in the endpoint section of the infura.io dashboard
			url: 'https://ropsten.infura.io/v3/<infura-project-id>',
			// find this private key in your metamask account
			accounts: [`0x${process.env.PRIVATE_KEY}`],
		},
	},
}
```

---

## Step 13: Deploy on the Ropsten Network

```bash
npx hardhat run scripts/deploy.js --network ropsten
```

Then change the `greeterAddress` inside the `App.js` file to the address of the deployed contract.

When using Ropsten Network, it will takes about a minute to get transactions to be confirmed.
